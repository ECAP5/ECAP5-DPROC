\section{Write-Back Module}

\begin{figure}[h!]
    \centering
    \input{arch/figures/wbm-arch.tex}
    \caption{Schematic view of the Write-Back Module}
    \label{fig:wbm}
\end{figure}

\subsection{Interface}

\begin{content}
The write-back module implements TBC. The signals are described in table \ref{tab:wbm-interface}. 
\end{content}

\input{arch/tables/wbm-interface}

\subsection{Specification}

\subsubsection{Upstream requirements}

The table \ref{tab:wbm-upstream-requirements} outlines the upstream requirements applicable to the Write-Back Module.

\input{arch/tables/wbm-upstream-requirements}

\subsubsection{Functional requirements}

\req{D\_WBM\_INPUT\_HANDSHAKE\_01}{
  The inputs to the write-back module shall be registered on the rising edge of \texttt{clk\_i} when both \texttt{input\_ready\_o} and \texttt{input\_valid\_i} are asserted.
}

\req{D\_WBM\_WRITE\_REQUEST\_01}{
  The write-back module shall emit a register write request on the rising edge of \texttt{clk\_i} upon registration of its inputs, when \texttt{result\_write\_i} is asserted.
}[
  derivedfrom=F\_INSTR\_RESULT\_02
]

\req{D\_WBM\_WRITE\_REQUEST\_02}{
  The \texttt{reg\_write\_o} signal shall be asserted on the rising edge of \texttt{clk\_i} when emitting a register write request.
}[
  derivedfrom=F\_INSTR\_RESULT\_02
]

\req{D\_WBM\_WRITE\_REQUEST\_03}{
  The \texttt{reg\_waddr\_o} signal shall be set to the registered \texttt{result\_addr\_i} when emitting a register write request.
}[
  derivedfrom=F\_INSTR\_RESULT\_02
]

\req{D\_WBM\_WRITE\_REQUEST\_04}{
  The \texttt{reg\_wdata\_o} signal shall be set to the registered \texttt{result\_i} when emitting a register write request.
}[
  derivedfrom=F\_INSTR\_RESULT\_02
]

\subsection{Behavior}

\subsubsection{Instruction with output behavior}

\begin{content}
  TBC : reg port directly wired to stage ff
\end{content}

\begin{figure}[H]
    \centering
    \input{arch/figures/wbm-behavior-instruction-with-output.tex}
    \caption{Timing diagram of the instruction with output behavior of the write-back module}
    \label{fig:wbm-behavior-instruction-with-output}
\end{figure}

\subsubsection{Instruction without output behavior}

\begin{content}
  TBC : reg port directly wired to stage ff
\end{content}

\begin{figure}[H]
    \centering
    \input{arch/figures/wbm-behavior-instruction-without-output.tex}
    \caption{Timing diagram of the instruction without output behavior of the write-back module}
    \label{fig:wbm-behavior-instruction-without-output}
\end{figure}

\subsubsection{Hazard behaviors}

\begin{content}
  Hazard behaviors are described in section \ref{pipeline-stall}.
\end{content}

\newpage
